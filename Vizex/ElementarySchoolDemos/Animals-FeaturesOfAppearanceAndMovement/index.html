<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Окружающий мир</title>
    <link rel="icon" href="icons/ico.png" type="image/png">
    <link rel="stylesheet" type="text/css" href="css/help.css?version=0.1"/>
    <link rel="stylesheet" type="text/css" href="style.css?version=0.1">
    <script src="js/jquery/jquery-3.4.1.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Condensed:ital,wght@0,100;0,300;0,400;0,700;1,100;1,300;1,400;1,700&display=swap" rel="stylesheet">
  </head>

  <body style="text-align: center">
    <div id="scene">
        <canvas id="unity-canvas" width=960 height=600></canvas>
        <div id="iframe-window" class="iframe-closed">
            <div class="iframe-header">
                <button class="header-button close-iframe" onclick="closeIFrame();"></button>
            </div>
            <iframe src="" width="100%" height="100%"></iframe>
        </div>
    </div>

    <div id="help-background" style="display: none">
      <div id="help">
        <div id="video"></div>
        <button type="button" id="close-help" onclick="hideHelpWeb()">
          <img src="help/close.png">
        </button>
      </div>
    </div>

    <div id="loader">
      <div id="unity-loading-bar">
        <div id="unity-progress-bar-full"></div>
        <div id="percentage">--%</div>
        <div class="title">
          <div class="title-ico">
            <img src="icons/ico.png" alt="Окружающий мир">
          </div>
          <div class="title-caption">
            <h5>Виртуальная лаборатория для начальной школы</h5>
            <h4>«Окружающий мир»</h4>
          </div>
        </div>
      </div>
    </div>

    <input type="hidden" id="tournament" value="">
    <input type="hidden" id="token" value="">
    <input type="hidden" id="locale" value="ru">

    <script type="text/javascript" src="js/video-player.js?version=0.1"></script>
    <script type="text/javascript" src="js/help-overlay.js?version=0.1"></script>
    <script type="text/javascript" src="js/iframe-opener.js?version=0.1"></script>
    <script src="Build/Animals-FeaturesOfAppearanceAndMovement.loader.js"></script>
    <script>
      const loaderIconsCount = 0;
      const buildUrl = "Build";
      const canvas = document.querySelector("#unity-canvas");
      const loader = document.querySelector("#loader");
      const logo = document.getElementById('logo');
      const progressBarFull = document.querySelector("#unity-progress-bar-full");
      const percentCounter = document.querySelector("#percentage");
      var counter = 0;
      var isLoading = true;
      var appInstance = null;


      var config =
      {
        dataUrl: buildUrl + "/Animals-FeaturesOfAppearanceAndMovement.data.unityweb",
        frameworkUrl: buildUrl + "/Animals-FeaturesOfAppearanceAndMovement.framework.js.unityweb",
        codeUrl: buildUrl + "/Animals-FeaturesOfAppearanceAndMovement.wasm.unityweb",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "Vizex",
        productName: "Окружающий мир",
        productVersion: "0.1",
      };

      createUnityInstance(canvas, config, OnLoadingProgress).
        then(OnLoadingComplete).
        catch(alert);

      function OnLoadingProgress(progress) 
      {
        progress = (progress * 100).toFixed(0) + "%";
        percentCounter.innerHTML = progress;
        progressBarFull.style.width = progress;
      }

      function OnLoadingComplete(unityInstance) 
      {
        appInstance = unityInstance;
        $('#loader').fadeOut(2000);
        setTimeout(function() {loader.style.display = "none";}, 2000);
        isLoading = false;
      }

      function IconsChanger()
      {
        logo.src = "icons/loader" + counter + ".png";

        if (++counter >= loaderIconsCount)
          counter = 0;
        if (isLoading)
          setTimeout(function() {IconsChanger();}, 250);
      }

      $(window).on('load', function(){
        $(parent.document).find('iframe').focus();
      })
    </script>
  </body>
</html>
